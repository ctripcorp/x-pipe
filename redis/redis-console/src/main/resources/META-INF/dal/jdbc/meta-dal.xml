<?xml version="1.0" encoding="UTF-8"?>
<entities do-package="com.ctrip.xpipe.redis.console.model" gen="true">
	<entity name="dc-tbl" table="DC_TBL" alias="dt">
		<var name="cluster-name" value-type="String"/>

		<relation name="cluster-info" entity-name="cluster-tbl" entity-alias="ct"/>
		<relation name="shard-info" entity-name="shard-tbl" entity-alias="st2"/>
		<relation name="dc-cluster-info" entity-name="dc-cluster-tbl" entity-alias="dct"/>
		<relation name="dc-cluster-shard-info" entity-name="dc-cluster-shard-tbl" entity-alias="dcst"/>
		<relation name="redis-info" entity-name="redis-tbl" entity-alias="rt"/>
		
		<readsets>
			<readset name="FULL_ACTIVE_KEEPERCONTAINER">
				<readset-ref name="FULL"/>
				<readset-ref name="FULL" relation-name="redis-info"/>
			</readset>
			<readset name="NAME">
				<member name='dc-name'/>
			</readset>
			<readset name="BASIC">
				<member name='id'/>
				<member name="zone-id"/>
				<member name='dc-name'/>
				<member name='dc-description'/>
			</readset>
		</readsets>
		
		<query-defs>
			<query name="find-all-dcs" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-dc-by-dc-name" type="SELECT" multiple="false">
				<param name='dc-name'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='dc-name'/> = ${dc-name}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-cluster-related-dc" type="SELECT" multiple="true">
				<param name="cluster-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name="cluster-info"/>, <TABLE name="dc-cluster-info"/>
					WHERE <FIELD name="id"/> = dct.dc_id
					AND ct.id = dct.cluster_id
					AND ct.cluster_name = ${cluster-name}
					AND ct.deleted = 0
					AND dct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>

			<query name="find-dc-details-by-dc-name" type="SELECT" multiple="true">
				<param name="dc-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name="cluster-info"/>, <TABLE name="shard-info"/>, <TABLE name="dc-cluster-info"/>,
					<TABLE name="dc-cluster-shard-info"/>, <TABLE name="redis-info"/>
					WHERE <FIELD name='dc-name'/> = ${dc-name}
					AND <FIELD name='id'/> = dct.dc_id
					AND dct.cluster_id = ct.id
					AND dct.dc_cluster_id = dcst.dc_cluster_id
					AND dcst.shard_id = st2.id
					AND dcst.dc_cluster_shard_id = rt.dc_cluster_shard_id
					AND ct.deleted = 0
					AND st2.deleted = 0
					AND dct.deleted = 0
					AND dcst.deleted = 0
					AND rt.deleted = 0
					AND ct.is_xpipe_interested = 1
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-all-active-keeper" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name="cluster-info"/>, <TABLE name="shard-info"/>, <TABLE name="dc-cluster-info"/>
					, <TABLE name="dc-cluster-shard-info"/>, <TABLE name="redis-info"/>
					WHERE <FIELD name='id'/> = dct.dc_id
					AND dct.cluster_id = ct.id
					AND dcst.dc_cluster_id = dct.dc_cluster_id
					AND dcst.shard_id = st2.id
					AND rt.dc_cluster_shard_id = dcst.dc_cluster_shard_id
					AND rt.keeper_active = 1
					AND ct.deleted = 0
					AND st2.deleted = 0
					AND dct.deleted = 0
					AND dcst.deleted = 0
					AND rt.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="cluster-tbl" table="CLUSTER_TBL" alias="ct">
		<member name="count" value-type="long" select-expr="COUNT(*)" all="false" />
		<var name="cluster-org-name" value-type="String"/>
		<var name="cluster-names" value-type="java.util.List&lt;String&gt;" />
		<var name="dc-id" value-type="long"/>

		<relation name="dc-info" entity-name="dc-tbl" entity-alias="dt" multiple="true"/>
		<relation name="dc-cluster-info" entity-name="dc-cluster-tbl" entity-alias="dct" multiple="true"/>
		<relation name="shard-info" entity-name="shard-tbl" entity-alias="st2" multiple="true"/>
		<relation name="organization-info" entity-name="organization-tbl" entity-alias="ot"/>

		<readsets>
			<readset name="COUNT">
				<member name="count"/>
			</readset>
			<readset name="NAME">
				<member name='cluster-name'/>
			</readset>
			<readset name="FULL_WITH_SHARDS">
				<readset-ref name="FULL"/>
				<readset-ref name="FULL" relation-name="shard-info"/>
			</readset>
			<readset name="FULL_WITH_ORG">
				<readset-ref name="FULL"/>
				<readset-ref name="FULL" relation-name="organization-info"/>
			</readset>
			<readset name="CLUSTER_META_INFO">
				<member name="id"/>
				<member name="cluster-name"/>
				<member name="status"/>
				<member name="activedc-id"/>
				<member name="cluster-org-id"/>
			</readset>
		</readsets>
		
		<query-defs>
			<query name="total-count" type="SELECT" multiple="false">
				<statement>
				<![CDATA[
				SELECT <FIELDS/>
		        FROM <TABLE/>
		        WHERE <FIELD name="deleted"/> = 0
				]]>
				</statement>
			</query>
			<query name="find-all-clusters" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-all-clusters-with-org-info" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> left join  <TABLE name='organization-info'/> on <FIELD name='cluster-org-id'/> = ot.id
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-clusters-by-active-dc-id" type="SELECT" multiple="true">
				<param name='activedc-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='activedc-id'/> = ${activedc-id}
					AND <FIELD name='deleted'/> = 0
					ORDER BY <FIELD name='id'/> DESC
					]]>
				</statement>
			</query>
			<query name="find-clusters-with-org-info-by-active-dc-id" type="SELECT" multiple="true">
				<param name='activedc-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> left join  <TABLE name='organization-info'/> on <FIELD name='cluster-org-id'/> = ot.id
					WHERE <FIELD name='activedc-id'/> = ${activedc-id}
					AND <FIELD name='deleted'/> = 0
					ORDER BY <FIELD name='id'/> DESC
					]]>
				</statement>
			</query>
			<query name="find-cluster-by-cluster-name" type="SELECT" multiple="false">
				<param name='cluster-name'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='cluster-name'/> = ${cluster-name}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-clusters-and-org-with-cluster-names" type="SELECT" multiple="true">
				<param name="cluster-names"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> left join  <TABLE name='organization-info'/> on <FIELD name='cluster-org-id'/> = ot.id
					WHERE <FIELD name='cluster-name'/> IN <IN>${cluster-names}</IN>
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-cluster-and-org-by-cluster-name" type="SELECT" multiple="false">
				<param name='cluster-name'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> left join  <TABLE name='organization-info'/> on <FIELD name='cluster-org-id'/> = ot.id
					WHERE <FIELD name='cluster-name'/> = ${cluster-name}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='delete-cluster' type='UPDATE' batch='false'>
				<param name='id'/>
				<param name='cluster-name'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='deleted'/> = 1 , <FIELD name='cluster-name'/> = ${cluster-name}
					WHERE <FIELD name='id'/> = ${id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='update-activedc-id' type='UPDATE' batch='false'>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='activedc-id'/> = ${activedc-id}
					WHERE <FIELD name='id'/> = ${id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='update-status-by-id' type='UPDATE' batch='false'>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='status'/> = ${status}
					WHERE <FIELD name='id'/> = ${id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-clusters-binded-by-dc-id" type="SELECT" multiple="true">
				<param name='dc-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> join <TABLE name='dc-cluster-info'/> on <FIELD name='id'/> = dct.cluster_id
					left join <TABLE name='organization-info'/> on <FIELD name='cluster-org-id'/> = ot.id
					WHERE dct.dc_id = ${dc-id}
					AND <FIELD name='deleted'/> = 0
					AND dct.deleted = 0
					AND ot.deleted = 0
					ORDER BY <FIELD name='id'/> ASC
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="dc-cluster-tbl" table="DC_CLUSTER_TBL" alias="dct">
		<var name="dc-name" value-type="String"/>
		<var name="cluster-name" value-type="String"/>
		<var name="cluster-ids" value-type="java.util.List&lt;Long&gt;" />
		

		<relation name="dc-info" entity-name="dc-tbl" entity-alias="dt"/>
		<relation name="cluster-info" entity-name="cluster-tbl" entity-alias="ct"/>

		<readsets>
			<readset name="FULL_WITH_DC">
				<readset-ref name="FULL"/>
				<readset-ref name="FULL" relation-name="dc-info"/>
			</readset>
		</readsets>

		<query-defs>
			<query name="find-dc-cluster-by-id" type="SELECT" multiple="false">
				<param name='dc-id'/>
				<param name='cluster-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='cluster-id' /> = ${cluster-id} 
					AND <FIELD name='dc-id' /> = ${dc-id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-dc-cluster-by-name" type="SELECT" multiple="false">
				<param name="dc-name"/>
				<param name="cluster-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='dc-info'/>, <TABLE name='cluster-info'/>
					WHERE <FIELD name='dc-id'/> = dt.id
					AND <FIELD name='cluster-id'/> = ct.id
					AND dt.dc_name = ${dc-name}
					AND ct.cluster_name = ${cluster-name}
					AND dt.deleted = 0
					AND ct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-all-by-cluster-id" type="SELECT" multiple="true">
				<param name="cluster-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='cluster-id' /> = ${cluster-id} 
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-by-cluster-ids" type="SELECT" multiple="true">
				<param name="cluster-ids"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='dc-info'/>
					WHERE <FIELD name='dc-id'/> = dt.id
					AND <FIELD name='cluster-id'/> IN <IN>${cluster-ids}</IN> 
					AND <FIELD name='deleted'/> = 0
					AND dt.deleted = 0
					]]>
				</statement>
			</query>
			<query name="find-all" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="delete-batch" type="UPDATE" batch="true">
				<param name="dc-cluster-id"/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='deleted'/> = 1
					WHERE <FIELD name='dc-cluster-id' /> = ${dc-cluster-id} 
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-all-by-dc-id" type="SELECT" multiple="true">
				<param name="dc-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='dc-id' /> = ${dc-id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="shard-tbl" table="SHARD_TBL" alias="st2">
		<var name="cluster-name" value-type="String"/>

		<relation name="cluster-info" entity-name="cluster-tbl" entity-alias="ct"/>

		<readsets>
			<readset name="NAME">
				<member name='shard-name'/>
			</readset>
			<readset name="MONITOR_NAME">
				<member name="setinel-monitor-name"/>
			</readset>
			<readset name="NAME_AND_MONITOR_NAME">
				<member name="shard-name"/>
				<member name="setinel-monitor-name"/>
			</readset>
		</readsets>

		<query-defs>
			<query name="find-all-by-cluster-id" type="SELECT" multiple="true">
				<param name='cluster-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='cluster-id' /> = ${cluster-id} 
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-all-by-cluster-name" type="SELECT" multiple="true">
				<param name="cluster-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='cluster-info'/>
					WHERE <FIELD name='cluster-id' /> = ct.id
					AND ct.cluster_name = ${cluster-name}
					AND ct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-shard" type="SELECT" multiple="false">
				<param name="cluster-name"/>
				<param name="shard-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='cluster-info'/>
					WHERE <FIELD name='shard-name'/> = ${shard-name}
					AND <FIELD name='cluster-id'/> = ct.id
					AND ct.cluster_name = ${cluster-name}
					AND ct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='delete-shards-batch' type='UPDATE' batch='true'>
				<param name='id'/>
				<param name='shard-name'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
        			SET <FIELD name='deleted'/> = 1, <FIELD name='shard-name'/> = ${shard-name}
       				WHERE <FIELD name='id'/> = ${id}
        			AND <FIELD name='deleted'/> = 0
        			]]>
				</statement>
			</query>
			<query name='delete-shard' type='UPDATE'>
				<param name='id'/>
				<param name='shard-name'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
        			SET <FIELD name='deleted'/> = 1 , <FIELD name='shard-name'/> = ${shard-name}
       				WHERE <FIELD name='id'/> = ${id}
        			AND <FIELD name='deleted'/> = 0
        			]]>
				</statement>
			</query>
			<query name="query-all-monitor-names" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="dc-cluster-shard-tbl" table="DC_CLUSTER_SHARD_TBL" alias="dcst">
		<var name="dc-id" value-type="Long"/>
		<var name="dc-name" value-type="String"/>
		<var name="cluster-name" value-type="String"/>
		<var name="shard-name" value-type="String"/>

		<relation name="dc-info" entity-name="dc-tbl" entity-alias="dt"/>
		<relation name="cluster-info" entity-name="cluster-tbl" entity-alias="ct"/>
		<relation name="shard-info" entity-name="shard-tbl" entity-alias="st2"/>
		<relation name="dc-cluster-info" entity-name="dc-cluster-tbl" entity-alias="dct"/>
		<relation name="redis-info" entity-name="redis-tbl" entity-alias="rt"/>

		<readsets>
			<readset name="SENTINEL_ID">
				<member name="setinel-id"/>
			</readset>
			<readset name="DC_CLUSTER_SHARD_META_INFO">
				<readset-ref name="SENTINEL_ID"/>
				<readset-ref name="CLUSTER_META_INFO" relation-name="cluster-info"/>
				<readset-ref name="REDIS_META_INFO" relation-name="redis-info"/>
				<readset-ref name="NAME_AND_MONITOR_NAME" relation-name="shard-info"/>
			</readset>
		</readsets>

		<query-defs>
			<query name='find-dc-cluster-shard' type='SELECT' multiple='false'>
				<param name='shard-id'/>
				<param name='dc-cluster-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='shard-id' /> = ${shard-id} 
					AND <FIELD name='dc-cluster-id' /> = ${dc-cluster-id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-dc-cluser-shard-by-name" type="SELECT" multiple="false">
				<param name="dc-name"/>
				<param name="cluster-name"/>
				<param name="shard-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='dc-info'/>, <TABLE name='cluster-info'/>,
						<TABLE name='shard-info'/>, <TABLE name='dc-cluster-info'/>
					WHERE <FIELD name='shard-id'/> = st2.id
					AND <FIELD name='dc-cluster-id'/> = dct.dc_cluster_id
					AND st2.shard_name = ${shard-name}
					AND dct.dc_id = dt.id
					AND dct.cluster_id = ct.id
					AND dt.dc_name = ${dc-name}
					AND ct.cluster_name = ${cluster-name}
					AND dt.deleted = 0
					AND ct.deleted = 0
					AND st2.deleted = 0
					AND dct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='find-all-by-dc-cluster-id' type='SELECT' multiple='true'>
				<param name='dc-cluster-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> 
					WHERE <FIELD name='dc-cluster-id' /> = ${dc-cluster-id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='find-all-by-shard-id' type='SELECT' multiple='true'>
				<param name='shard-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> 
					WHERE <FIELD name='shard-id' /> = ${shard-id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='find-all-by-dc-cluster-names' type='SELECT' multiple='true'>
				<param name="dc-name"/>
				<param name="cluster-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='dc-info'/>, <TABLE name='cluster-info'/>, <TABLE name='dc-cluster-info'/>
					WHERE <FIELD name='dc-cluster-id'/> = dct.dc_cluster_id
					AND dct.dc_id = dt.id
					AND dct.cluster_id = ct.id
					AND dt.dc_name = ${dc-name}
					AND ct.cluster_name = ${cluster-name}
					AND dt.deleted = 0
					AND ct.deleted = 0
					AND dct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='find-all-by-dc-id' type='SELECT' multiple='true'>
				<param name="dc-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='cluster-info'/>, <TABLE name='dc-cluster-info'/>, <TABLE name='redis-info'/>, <TABLE name='shard-info'/>
					WHERE dct.dc_id = ${dc-id}
					AND dct.cluster_id = ct.id
					AND <FIELD name='dc-cluster-id'/> = dct.dc_cluster_id
					AND <FIELD name='shard-id' /> = st2.id
					AND <FIELD name='dc-cluster-shard-id'/> = rt.dc_cluster_shard_id
					AND st2.deleted = 0
					AND rt.deleted = 0
					AND ct.deleted = 0
					AND dct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='insert-batch' type='INSERT' batch='true'>
				<statement>
					<![CDATA[
					INSERT INTO <TABLE/>(<FIELDS/>)
        			VALUES(<VALUES/>)
        			]]>
        		</statement>
			</query>
			<query name='delete-dc-cluster-shards-batch' type='UPDATE' batch='true'>
				<param name='dc-cluster-shard-id'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
        			SET <FIELD name='deleted'/> = 1
       				WHERE <FIELD name='dc-cluster-shard-id'/> = ${dc-cluster-shard-id}
        			AND <FIELD name='deleted'/> = 0
        			]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="redis-tbl" table="REDIS_TBL" alias="rt">
		<!-- Add two constant below to fix bug, that when use h2 db in unit/integration test -->
		<!-- RedisService.updateRedis() will fail, due to h2 db not recognize sequential insert with id of 0 -->
		<member name="id" field="id" value-type="Long" length="20" nullable="true" key="true" auto-increment="true" />
		<var name="key-id" value-type="Long" key-member="id" />

		<var name="dc-name" value-type="String"/>
		<var name="cluster-name" value-type="String"/>

		<relation name="dc-info" entity-name="dc-tbl" entity-alias="dt"/>
		<relation name="cluster-info" entity-name="cluster-tbl" entity-alias="ct"/>
		<relation name="dc-cluster-info" entity-name="dc-cluster-tbl" entity-alias="dct"/>
		<relation name="dc-cluster-shard-info" entity-name="dc-cluster-shard-tbl" entity-alias="dcst"/>

		<readsets>
			<readset name="IP-AND-PORT">
				<member name='redis-ip'/>
				<member name="redis-port"/>
			</readset>
			<readset name="REDIS_META_INFO">
				<member name="redis-ip"/>
				<member name="redis-port"/>
				<member name="run-id"/>
				<member name="redis-role"/>
				<member name="keeper-active"/>
				<member name="master"/>
				<member name="redis-master"/>
				<member name="keepercontainer-id"/>
			</readset>
		</readsets>

		<query-defs>

			<query name="find-all-by-dc-cluster-name" type="SELECT" multiple="true">
				<param name="dc-name"/>
				<param name="cluster-name"/>
				<param name="redis-role"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='dc-info'/>, <TABLE name='cluster-info'/>, <TABLE name='dc-cluster-info'/>, <TABLE name='dc-cluster-shard-info'/>
					WHERE dt.dc_name = ${dc-name}
					AND ct.cluster_name = ${cluster-name}
					AND dct.dc_id = dt.id
					AND dct.cluster_id = ct.id
					AND dct.dc_cluster_id = dcst.dc_cluster_id
					AND dcst.dc_cluster_shard_id = <FIELD name='dc-cluster-shard-id' />
					AND <FIELD name='redis-role'/> = ${redis-role}
					AND dt.deleted = 0
					AND ct.deleted = 0
					AND dct.deleted = 0
					AND dcst.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>

			<query name='find-all-by-dc-cluster-shard-id' type='SELECT' multiple="true">
				<param name='dc-cluster-shard-id'/>
				<param name='redis-role'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='dc-cluster-shard-id' /> = ${dc-cluster-shard-id}
					<IF field="redis-role" type="NOT_NULL">
						AND <FIELD name='redis-role'/> = ${redis-role}
					</IF>
					AND <FIELD name='deleted'/> = 0
					ORDER BY <FIELD name='id'/>
					]]>
				</statement>
			</query>
			<query name='find-all-with-history-by-dc-cluster-shard-id' type='SELECT' multiple="true">
				<param name='dc-cluster-shard-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='dc-cluster-shard-id' /> = ${dc-cluster-shard-id}
					]]>
				</statement>
			</query>
			<query name='find-by-runid' type='SELECT' multiple="true">
				<param name='run-id'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='run-id' /> = ${run-id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='find-with-ip-port' type='SELECT' multiple="false">
				<param name='redis-ip'/>
				<param name='redis-port'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='redis-ip' /> = ${redis-ip}
					AND <FIELD name='redis-port' /> = ${redis-port}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='find-by-ip' type='SELECT' multiple="true">
				<param name='redis-ip'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='redis-ip' /> = ${redis-ip}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='find-with-basic-configurations' type='SELECT' multiple='false'>
				<param name='run-id'/>
				<param name='dc-cluster-shard-id'/>
				<param name='redis-ip'/>
				<param name='redis-port'/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='run-id'/> = ${run-id}
					AND <FIELD name='dc-cluster-shard-id'/> = ${dc-cluster-shard-id} 
					AND <FIELD name='redis-ip' /> = ${redis-ip}
					AND <FIELD name='redis-port' /> = ${redis-port}
					AND <FIELD name='deleted'/> = 0
					ORDER BY <FIELD name='id'/>
					]]>
				</statement>
			</query>
			<query name='delete-batch' type="UPDATE" batch="true">
				<param name='id'/>
				<param name='run-id'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
        			SET <FIELD name='deleted'/> = 1, <FIELD name='run-id'/> = ${run-id}
       				WHERE <FIELD name='id'/> = ${id}
        			AND <FIELD name='deleted'/> = 0
        			]]>
				</statement>
			</query>
			<query name='insert-batch' type='INSERT' batch='true'>
				<statement>
					<![CDATA[
					INSERT INTO <TABLE/>(<FIELDS/>)
        			VALUES(<VALUES/>)
        			]]>
        		</statement>
			</query>
			<query name='update-batch' type='UPDATE' batch='true'>
				<param name='id'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
        			SET <FIELD name='run-id'/> = ${run-id}, <FIELD name='redis-ip'/> = ${redis-ip}, <FIELD name='redis-port'/> = ${redis-port},
        				<FIELD name='keeper-active'/> = ${keeper-active}, <FIELD name='redis-master'/> = ${redis-master}, <FIELD name='keepercontainer-id'/> = ${keepercontainer-id},
        				<FIELD name='master'/> = ${master}
       				WHERE <FIELD name='id'/> = ${id}
        			AND <FIELD name='deleted'/> = 0
        			]]>
				</statement>
			</query>
			<query name='update-batch-master' type='UPDATE' batch='true'>
				<param name='id'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
        			SET <FIELD name='master'/> = ${master}
       				WHERE <FIELD name='id'/> = ${id}
        			AND <FIELD name='deleted'/> = 0
        			]]>
				</statement>
			</query>
			<query name='update-batch-keeper-active' type='UPDATE' batch='true'>
				<param name='id'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
        			SET <FIELD name='keeper-active'/> = ${keeper-active}
       				WHERE <FIELD name='id'/> = ${id}
        			AND <FIELD name='deleted'/> = 0
        			]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="metaserver-tbl" table="METASERVER_TBL" alias="mt">
		<var name="dc-name" value-type="String"/>

		<relation name="dc-info" entity-name="dc-tbl" entity-alias="dt"/>

		<query-defs>
			<query name="find-by-dc-name" type="SELECT" multiple="true">
				<param name="dc-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name="dc-info"/>
					WHERE <FIELD name='dc-id'/> = dt.id
					AND dt.dc_name = ${dc-name}
					AND dt.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-active-by-dc-id" type="SELECT" multiple="false">
				<param name="dc-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='dc-id'/> = ${dc-id}
					AND <FIELD name='metaserver-active'/> = 1
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-active-by-dc-name" type="SELECT" multiple="false">
				<param name="dc-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name="dc-info"/>
					WHERE <FIELD name='dc-id'/> = dt.id
					AND dt.dc_name = ${dc-name}
					AND <FIELD name='metaserver-active'/> = 1
					AND dt.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="setinel-tbl" table="SETINEL_TBL" alias="st">
		<var name="dc-name" value-type="String"/>

		<relation name="dc-info" entity-name="dc-tbl" entity-alias="dt"/>
		<relation name="dc-cluster-shard-info" entity-name="dc-cluster-shard-tbl" entity-alias="dcst"/>

		<member name="count" value-type="long" select-expr="COUNT(*) count" all="false"/>

		<readsets>
            <readset name="COUNT">
                <member name="count"/>
            </readset>
			<readset name="SENTINEL-USAGE">
                <readset-ref name="FULL"/>
                <readset-ref name="COUNT"/>
                <readset-ref name="FULL" relation-name="dc-info"/>
			</readset>
		</readsets>

		<updatesets>
			<updateset name="ADDRESS">
				<member name="setinel-id"/>
				<member name="setinel-address"/>
			</updateset>
		</updatesets>

		<query-defs>
			<query name="find-by-dc-id" type="SELECT" multiple="true">
				<param name="dc-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='dc-id'/> = ${dc-id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-by-dc-name" type="SELECT" multiple="true">
				<param name="dc-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name="dc-info"/>
					WHERE <FIELD name='dc-id'/> = dt.id
					AND dt.dc_name = ${dc-name}
					AND dt.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='find-all' type='SELECT' multiple='true'>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-sentinel-usage" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> left join <TABLE name='dc-cluster-shard-info'/>
					on <FIELD name='setinel-id'/> = dcst.setinel_id, <TABLE name='dc-info'/>
					WHERE <FIELD name='deleted'/> = 0
					AND dcst.deleted = 0
					AND dt.id = <FIELD name='dc-id'/>
					GROUP BY <FIELD name='setinel-id'/>
					]]>
				</statement>
			</query>

			<query name="update-sentinel-addr" type="UPDATE" batch="false">
				<statement>
					<![CDATA[
						UPDATE <TABLE/>
						SET <FIELD name='setinel-address'/> = ${setinel-address}
						WHERE <FIELD name='setinel-id'/> = ${setinel-id}
						]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="keepercontainer-tbl" table="KEEPERCONTAINER_TBL" alias="kt">
		<var name="dc-name" value-type="String"/>
		<var name="org-id" value-type="long"/>

		<member name="count" value-type="long" select-expr="COUNT(*) count" all="false"/>

		<relation name="dc-info" entity-name="dc-tbl" entity-alias="dt"/>
		<relation name="keeper-info" entity-name="redis-tbl" entity-alias="kit"/>

		<readsets>
			<readset name="KEEPER_COUNT">
				<member name='keepercontainer-id'/>
				<member name='keepercontainer-ip'/>
				<member name="count"/>
			</readset>

			<readset name="KEEPER_COUNT_BY_CLUSTER">
				<member name='keepercontainer-id'/>
				<member name='keepercontainer-ip'/>
				<member name='keepercontainer-port'/>
				<member name="keepercontainer-active"/>
				<member name="keepercontainer-dc"/>
				<member name="count"/>
				<member name="keepercontainer-org-id" />
			</readset>
		</readsets>
		<query-defs>
			<query name="find-by-dc-name" type="SELECT" multiple="true">
				<param name="dc-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name="dc-info"/>
					WHERE <FIELD name='keepercontainer-dc'/> = dt.id
					AND dt.dc_name = ${dc-name}
					AND dt.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-active-by-dc-name" type="SELECT" multiple="true">
				<param name="dc-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name="dc-info"/>
					WHERE <FIELD name='keepercontainer-dc'/> = dt.id
					AND dt.dc_name = ${dc-name}
					AND dt.deleted = 0
					AND <FIELD name='keepercontainer-active'/> = 1
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-keeper-count" type="SELECT" multiple="true">
				<param name="dc-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> left join  <TABLE name='keeper-info'/> on <FIELD name='keepercontainer-id'/> = kit.keepercontainer_id , <TABLE name='dc-info'/>
					WHERE <FIELD name='keepercontainer-dc'/> = dt.id
					AND dt.dc_name = ${dc-name}
					AND <FIELD name='keepercontainer-active'/> = 1
					AND (kit.deleted = 0 or kit.deleted is null)
					AND <FIELD name='deleted'/> = 0
					GROUP BY <FIELD name='keepercontainer-id'/>
					order by count
					]]>
				</statement>
			</query>
			<query name="find-keeper-container-by-cluster" type="SELECT" multiple="true">
				<param name="dc-name"/>
				<param name="org-id" />
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/> left join  <TABLE name='keeper-info'/> on <FIELD name='keepercontainer-id'/> = kit.keepercontainer_id AND (kit.deleted = 0 or kit.deleted is null), <TABLE name='dc-info'/>
					WHERE <FIELD name='keepercontainer-dc'/> = dt.id
					AND dt.dc_name = ${dc-name}
					AND <FIELD name='keepercontainer-active'/> = 1
					AND <FIELD name='deleted'/> = 0
					AND <FIELD name='keepercontainer-org-id'/> = ${org-id}
					GROUP BY <FIELD name='keepercontainer-id'/>
					order by count
					]]>
				</statement>
			</query>
			<query name="find-by-ip-port" type="SELECT" multiple="false">
				<param name="keepercontainer-ip"/>
				<param name="keepercontainer-port"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='keepercontainer-ip'/> = ${keepercontainer-ip}
					AND <FIELD name='keepercontainer-port'/> = ${keepercontainer-port}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="migration-event-tbl" table="migration_event_tbl" alias="met">
		<relation name="migration-clusters" entity-name="migration-cluster-tbl" entity-alias="mct" multiple="true"/>
		
		<relation name="redundant-clusters" entity-name="migration-cluster-tbl" entity-alias="mct"/>
		<relation name="redundant-shards" entity-name="migration-shard-tbl" entity-alias="mst"/>
		
		<readsets>
			<readset name="FULL_ALL">
				<readset-ref name="FULL"/>
				<readset-ref name="FULL" relation-name="redundant-clusters"/>
				<readset-ref name="FULL" relation-name="redundant-shards"/>
			</readset>
		</readsets>
		
		<query-defs>
			<query name="find-by-tag" type="SELECT">
				<param name="event-tag"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='event-tag'/> = ${event-tag}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-all" type="SELECT" multiple="true">
				<statement>
				<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					ORDER BY <FIELD name='id'/> DESC
					]]>
				</statement>
			</query>
			<query name="find-with-all-details" type="SELECT" multiple="true">
				<param name='id'/>
				<statement>
				<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='redundant-clusters'/>, <TABLE name='redundant-shards'/>
					WHERE <FIELD name='id'/> = ${id}
					AND mct.migration_event_id = ${id}
					AND mst.migration_cluster_id = mct.id
					AND mct.deleted = 0
					AND mst.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name="find-unfinished-events" type="SELECT" multiple="true">
				<statement>
				<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='redundant-clusters'/>
					WHERE <FIELD name='id'/> = mct.migration_event_id
					AND mct.status != 'Success'
					AND mct.status != 'ForceEnd'
					AND mct.status != 'Aborted'
					AND mct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			
			<query name='insert-batch' type='INSERT' batch='true'>
				<statement>
					<![CDATA[
					INSERT INTO <TABLE/>(<FIELDS/>)
        			VALUES(<VALUES/>)
        			]]>
        		</statement>
			</query>
		</query-defs>
	</entity>
	
	<entity name="migration-cluster-tbl" table="migration_cluster_tbl" alias="mct">
		<var name="event-id" value-type="long"/>

		<relation name="cluster" entity-name="cluster-tbl" entity-alias="ct"/>
		<relation name="migration-event" entity-name="migration-event-tbl" entity-alias="met"/>
		<relation name="migration-shards" entity-name="migration-shard-tbl" entity-alias="mst" multiple="true"/>
		
		<readsets>
			<readset name="FULL_ALL">
				<readset-ref name="FULL"/>
				<readset-ref name="FULL" relation-name="cluster"/>
			</readset>
		</readsets>
		
		<query-defs>
			<query name="find-by-event-id" type="SELECT" multiple="true">
				<param name="event-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>,<TABLE name='migration-event'/>,<TABLE name='cluster'/>
					WHERE <FIELD name='migration-event-id'/> = ${event-id}
					AND met.id = ${event-id}
					AND ct.id = <FIELD name='cluster-id'/>
					AND ct.deleted = 0
					AND met.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			
			<query name="find-by-event-id-and-cluster-id" type="SELECT">
				<param name="event-id"/>
				<param name="cluster-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>,<TABLE name="migration-event"/>
					WHERE <FIELD name='migration-event-id'/> = ${event-id}
					AND <FIELD name="cluster-id"/> = ${cluster-id}
					AND met.id = ${event-id}
					AND met.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			
			<query name="find-all-by-cluster-id" type="SELECT" multiple="true">
				<param name="cluster-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name="cluster-id"/> = ${cluster-id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>

			<query name="find-unfinished-by-cluster-id" type="SELECT" multiple="true">
				<param name="cluster-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name="cluster-id"/> = ${cluster-id}
					AND mct.status != 'Success'
					AND mct.status != 'ForceEnd'
					AND mct.status != 'Aborted'
					AND <FIELD name='deleted'/> = 0
					ORDER BY id asc
					]]>
				</statement>
			</query>

			<query name="update-start-time-by-id" type="UPDATE" batch="false">
				<statement>
						<![CDATA[
						UPDATE <TABLE/>
						SET <FIELD name='start-time'/> = ${start-time}
						WHERE <FIELD name='id'/> = ${id}
						]]>
				</statement>
			</query>
			<query name="update-status-and-end-time-by-id" type="UPDATE" batch="false">
				<statement>
					<![CDATA[
						UPDATE <TABLE/>
						SET <FIELD name='end-time'/> = ${end-time},
						<FIELD name='status'/> = ${status}
						WHERE <FIELD name='id'/> = ${id}
						]]>
				</statement>
			</query>
			<query name="update-publish-info-by-id" type="UPDATE" batch="false">
				<statement>
					<![CDATA[
						UPDATE <TABLE/>
						SET <FIELD name='publish-info'/> = ${publish-info}
						WHERE <FIELD name='id'/> = ${id}
					]]>
				</statement>
			</query>
			<query name='insert-batch' type='INSERT' batch='true'>
				<statement>
					<![CDATA[
					INSERT INTO <TABLE/>(<FIELDS/>)
        			VALUES(<VALUES/>)
        			]]>
        		</statement>
			</query>
		</query-defs>
	</entity>
	
	<entity name="migration-shard-tbl" table="migration_shard_tbl" alias="mst">
		<relation name="shard" entity-name="shard-tbl" entity-alias="st2"/>
	
		<readsets>
			<readset name="FULL_ALL">
				<readset-ref name="FULL"/>
				<readset-ref name="FULL" relation-name="shard"/>
			</readset>
		</readsets>
	
		<query-defs>
			<query name="find-by-migration-cluster-id" type="SELECT" multiple="true">
				<param name="migration-cluster-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>, <TABLE name='shard'/>
					WHERE <FIELD name='migration-cluster-id'/> = ${migration-cluster-id}
					AND st2.id = <FIELD name='shard-id'/>
					AND st2.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		
			<query name='insert-batch' type='INSERT' batch='true'>
				<statement>
					<![CDATA[
					INSERT INTO <TABLE/>(<FIELDS/>)
        			VALUES(<VALUES/>)
        			]]>
        		</statement>
			</query>
			<query name='update-log-by-id' type='UPDATE' batch='false'>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='log'/> = ${log}
					WHERE <FIELD name='id'/> = ${id}
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="config-tbl" table="config_tbl" alias="cfgt">

		<readsets>
			<readset name="value">
				<member name='value'/>
			</readset>
		</readsets>

		<query-defs>
			<query name="update-by-key" type="UPDATE" batch="false">
				<param name="key"/>
				<param name="value"/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='value'/> = ${value}
					WHERE <FIELD name='key'/> = ${key}
					]]>
				</statement>
			</query>

			<query name="update-val-and-until-by-key" type="UPDATE" batch="false">
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='value'/> = ${value},
					<FIELD name='until' /> = ${until},
					<FIELD name='latest-update-user' /> = ${latest-update-user},
					<FIELD name='latest-update-ip' /> = ${latest-update-ip}
					WHERE <FIELD name='key'/> = ${key}
					]]>
				</statement>
			</query>


			<query name="find-by-key" type="SELECT" multiple="false">
				<param name="key"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='key'/> = ${key}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>
	<entity name="organization-tbl" table="organization_tbl" alias="ot">
		<member name="id" field="id" value-type="Long" length="20" nullable="true" key="true" auto-increment="true" />

		<relation name="cluster-info" entity-name="cluster-tbl" entity-alias="ct"/>

		<var name="target-org-name" value-type="String"/>
		<var name="target-org-id" value-type="long"/>

		<readsets>
			<readset name="id-and-name">
				<member name='id'/>
				<member name='org-name'/>
			</readset>
		</readsets>

		<query-defs>
			<query name="find-org-by-name" type="SELECT" multiple="false">
				<param name="target-org-name"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name="org-name"/> = ${target-org-name}
					]]>
				</statement>
			</query>

			<query name="find-involved-orgs" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT DISTINCT <FIELDS/>
					FROM <TABLE/>, <TABLE name='cluster-info'/>
					WHERE <FIELD name='id'/> = ct.cluster_org_id
					AND ct.deleted = 0
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>

			<query name="find-org-by-org-id" type="SELECT" multiple="false">
				<param name="target-org-id"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name="org-id"/> = ${target-org-id}
					]]>
				</statement>
			</query>

			<query name="find-all-orgs" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='insert-batch' type='INSERT' batch='true'>
				<statement>
					<![CDATA[
					INSERT INTO <TABLE/>(<FIELDS/>)
        			VALUES(<VALUES/>)
        			]]>
				</statement>
			</query>

			<query name='update-batch' type='UPDATE' batch='true'>
				<param name='id'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
        			SET <FIELD name='org-id'/> = ${org-id}, <FIELD name='org-name'/> = ${org-name}
       				WHERE <FIELD name='id'/> = ${id}
        			AND <FIELD name='deleted'/> = 0
        			]]>
				</statement>
			</query>
		</query-defs>
	</entity>
	<entity name="event-tbl" table="event_tbl" alias="et">

		<var name="target-event-type" value-type="String"/>
		<var name="target-date" value-type="Date"/>

		<query-defs>
			<query name="find-event-by-type" type="SELECT" multiple="true">
				<param name="target-event-type"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name="event-type"/> = ${target-event-type}
					]]>
				</statement>
			</query>
			<query name="find-event-by-type-after-date" type="SELECT" multiple="true">
				<param name="target-event-type"/>
				<param name="target-date"/>
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name="event-type"/> = ${target-event-type}
					AND <FIELD name="data-change-last-time"/> >= ${target-date}
					]]>
				</statement>
			</query>

		</query-defs>
	</entity>
	<entity name="proxy-tbl" table="proxy_tbl" alias="pt">

		<readsets>
			<readset name="id-dc-uri">
				<member name='id'/>
				<member name='dc_id'/>
				<member name="uri"/>
				<member name="active"/>
				<member name="monitor-active"/>
			</readset>
		</readsets>
		<query-defs>
			<query name="find-all-active" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					AND <FIELD name='active'/> = 1
					]]>
				</statement>
			</query>
			<query name="find-all-monitor-active" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					AND <FIELD name='monitor-active'/> = 1
					]]>
				</statement>
			</query>
			<query name="find-all" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='delete-proxy' type='UPDATE' batch='false'>
				<param name='id'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='deleted'/> = 1
					WHERE <FIELD name='id'/> = ${id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>
	<entity name="route-tbl" table="route_tbl" alias="routetbl">

		<readsets>
			<readset name="main">
				<member name='id'/>
				<member name="tag"/>
				<member name="active"/>
				<member name='route_org_id'/>
				<member name="src_dc_id"/>
				<member name="dst_dc_id"/>
				<member name="src_proxy_ids"/>
				<member name="dst_proxy_ids"/>
				<member name="optional_proxy_ids"/>
			</readset>
		</readsets>
		<updatesets>
			<updateset name="main">
				<member name="tag"/>
				<member name="active"/>
				<member name='route_org_id'/>
				<member name="src_dc_id"/>
				<member name="dst_dc_id"/>
				<member name="src_proxy_ids"/>
				<member name="dst_proxy_ids"/>
				<member name="optional_proxy_ids"/>
			</updateset>
		</updatesets>
		<query-defs>
			<query name="find-all-active" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					AND <FIELD name='active'/> = 1
					]]>
				</statement>
			</query>
			<query name="find-all" type="SELECT" multiple="true">
				<statement>
					<![CDATA[
					SELECT <FIELDS/>
					FROM <TABLE/>
					WHERE <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
			<query name='delete-route' type='UPDATE' batch='false'>
				<param name='id'/>
				<statement>
					<![CDATA[
					UPDATE <TABLE/>
					SET <FIELD name='deleted'/> = 1
					WHERE <FIELD name='id'/> = ${id}
					AND <FIELD name='deleted'/> = 0
					]]>
				</statement>
			</query>
		</query-defs>
	</entity>
</entities>
